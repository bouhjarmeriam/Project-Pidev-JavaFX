<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import de.jensd.fx.glyphs.fontawesome.FontAwesomeIconView?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="controllers.PatientDashboardController"
            style="-fx-background-color: linear-gradient(to bottom, #e3f2fd, #bbdefb);">
    <top>
        <VBox spacing="0">
            <!-- Header -->
            <HBox alignment="CENTER_LEFT" style="-fx-background-color: linear-gradient(to right, #1565c0, #0d47a1); -fx-padding: 15 25; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 10, 0, 0, 3);">
                <FontAwesomeIconView glyphName="USER_MD" size="30" glyphStyle="-fx-fill: white;"/>
                <Label text="Espace Patient" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: white; -fx-font-family: 'Segoe UI'; -fx-padding: 0 0 0 15;"/>
                <Region HBox.hgrow="ALWAYS" />
                <HBox spacing="20" alignment="CENTER">
                    <Label fx:id="lblPatientName" text="Nom du Patient" style="-fx-font-size: 16px; -fx-text-fill: white; -fx-font-family: 'Segoe UI';"/>
                    <Button fx:id="btnLogout" text="Déconnexion" onAction="#handleLogout" 
                           style="-fx-background-color: rgba(255,255,255,0.2); -fx-text-fill: white; -fx-background-radius: 20; -fx-border-radius: 20; -fx-cursor: hand;">
                        <graphic>
                            <FontAwesomeIconView glyphName="SIGN_OUT" size="16" glyphStyle="-fx-fill: white;"/>
                        </graphic>
                    </Button>
                </HBox>
            </HBox>
            
            <!-- Navigation Tabs -->
            <TabPane fx:id="tabPane" tabClosingPolicy="UNAVAILABLE" style="-fx-tab-min-height: 50; -fx-tab-max-height: 50;">
                <tabs>
                    <Tab text="Tableau de Bord" closable="false">
                        <graphic>
                            <FontAwesomeIconView glyphName="HOME" size="18" glyphStyle="-fx-fill: #1565c0;"/>
                        </graphic>
                    </Tab>
                    <Tab text="Mon Dossier Médical" closable="false" onSelectionChanged="#handleDossierTabSelected">
                        <graphic>
                            <FontAwesomeIconView glyphName="FOLDER_OPEN" size="18" glyphStyle="-fx-fill: #1565c0;"/>
                        </graphic>
                    </Tab>
                    <Tab text="Mes Séjours" closable="false" onSelectionChanged="#handleSejoursTabSelected">
                        <graphic>
                            <FontAwesomeIconView glyphName="BED" size="18" glyphStyle="-fx-fill: #1565c0;"/>
                        </graphic>
                    </Tab>
                </tabs>
            </TabPane>
        </VBox>
    </top>

    <center>
        <StackPane>
            <!-- Dashboard Content -->
            <VBox fx:id="dashboardContent" spacing="20" visible="true" managed="true">
                <padding>
                    <Insets top="30" right="30" bottom="30" left="30"/>
                </padding>
                
                <HBox spacing="20">
                    <!-- Welcome Card -->
                    <VBox style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);" 
                          HBox.hgrow="ALWAYS" maxWidth="Infinity">
                        <padding>
                            <Insets top="25" right="25" bottom="25" left="25"/>
                        </padding>
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <FontAwesomeIconView glyphName="USER_CIRCLE" size="40" glyphStyle="-fx-fill: #1565c0;"/>
                            <VBox>
                                <Label text="Bienvenue" style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #1565c0; -fx-font-family: 'Segoe UI';"/>
                                <Label fx:id="lblWelcome" text="Heureux de vous revoir!" style="-fx-font-size: 16px; -fx-text-fill: #546e7a; -fx-font-family: 'Segoe UI';"/>
                            </VBox>
                        </HBox>
                    </VBox>
                    
                    <!-- Stats Card -->
                    <HBox spacing="20" HBox.hgrow="ALWAYS">
                        <!-- Dossier Card -->
                        <VBox alignment="CENTER" style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);" 
                              HBox.hgrow="ALWAYS" maxWidth="Infinity">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <HBox alignment="CENTER" spacing="10">
                                <FontAwesomeIconView glyphName="FOLDER_OPEN" size="30" glyphStyle="-fx-fill: #1976d2;"/>
                                <Label text="Dossier" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #1976d2; -fx-font-family: 'Segoe UI';"/>
                            </HBox>
                            <Label fx:id="lblDossierCount" text="1" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #1976d2; -fx-font-family: 'Segoe UI';"/>
                            <Label text="Dossier Médical" style="-fx-font-size: 14px; -fx-text-fill: #546e7a; -fx-font-family: 'Segoe UI';"/>
                        </VBox>
                        
                        <!-- Séjours Card -->
                        <VBox alignment="CENTER" style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);" 
                              HBox.hgrow="ALWAYS" maxWidth="Infinity">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <HBox alignment="CENTER" spacing="10">
                                <FontAwesomeIconView glyphName="BED" size="30" glyphStyle="-fx-fill: #2196f3;"/>
                                <Label text="Séjours" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2196f3; -fx-font-family: 'Segoe UI';"/>
                            </HBox>
                            <Label fx:id="lblSejourCount" text="0" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2196f3; -fx-font-family: 'Segoe UI';"/>
                            <Label text="Hospitalisations" style="-fx-font-size: 14px; -fx-text-fill: #546e7a; -fx-font-family: 'Segoe UI';"/>
                        </VBox>
                    </HBox>
                </HBox>
                
                <!-- Recent Activity -->
                <VBox spacing="15" style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <FontAwesomeIconView glyphName="HISTORY" size="20" glyphStyle="-fx-fill: #1565c0;"/>
                        <Label text="Derniers Séjours" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1565c0; -fx-font-family: 'Segoe UI';"/>
                    </HBox>
                    
                    <TableView fx:id="recentSejoursTable" prefHeight="250" style="-fx-border-color: #E0E0E0; -fx-border-radius: 5;">
                        <columns>
                            <TableColumn fx:id="colRecentDateEntree" text="Date d'entrée" prefWidth="120"/>
                            <TableColumn fx:id="colRecentDateSortie" text="Date de sortie" prefWidth="120"/>
                            <TableColumn fx:id="colRecentTypeSejour" text="Type" prefWidth="120"/>
                            <TableColumn fx:id="colRecentFraisSejour" text="Frais" prefWidth="100"/>
                            <TableColumn fx:id="colRecentStatutPaiement" text="Statut" prefWidth="100"/>
                        </columns>
                        <placeholder>
                            <HBox alignment="CENTER" spacing="10">
                                <FontAwesomeIconView glyphName="INFO_CIRCLE" size="20" glyphStyle="-fx-fill: #90a4ae;"/>
                                <Label text="Aucun séjour récent" style="-fx-font-family: 'Segoe UI'; -fx-text-fill: #90a4ae;"/>
                            </HBox>
                        </placeholder>
                    </TableView>
                </VBox>
            </VBox>
            
            <!-- Dossier Medical Content -->
            <ScrollPane fx:id="dossierContent" fitToWidth="true" visible="false" managed="false"
                       style="-fx-background: transparent; -fx-background-color: transparent; -fx-padding: 0;">
                <VBox spacing="20">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>
                    
                    <!-- Dossier Info -->
                    <VBox spacing="15" style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <FontAwesomeIconView glyphName="FOLDER_OPEN" size="24" glyphStyle="-fx-fill: #1565c0;"/>
                            <Label text="Informations du Dossier" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1565c0; -fx-font-family: 'Segoe UI';"/>
                        </HBox>
                        
                        <GridPane hgap="20" vgap="15">
                            <columnConstraints>
                                <ColumnConstraints minWidth="150" prefWidth="200"/>
                                <ColumnConstraints hgrow="ALWAYS" minWidth="250" prefWidth="400"/>
                            </columnConstraints>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10" GridPane.rowIndex="0" GridPane.columnIndex="0">
                                <FontAwesomeIconView glyphName="ID_CARD" size="14" glyphStyle="-fx-fill: #1565c0;"/>
                                <Label text="Numéro de dossier:" style="-fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-text-fill: #37474f;"/>
                            </HBox>
                            <Label fx:id="lblDossierId" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 14px; -fx-text-fill: #37474f;" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10" GridPane.rowIndex="1" GridPane.columnIndex="0">
                                <FontAwesomeIconView glyphName="CALENDAR" size="14" glyphStyle="-fx-fill: #1565c0;"/>
                                <Label text="Date de création:" style="-fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-text-fill: #37474f;"/>
                            </HBox>
                            <Label fx:id="lblDossierDateCreation" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 14px; -fx-text-fill: #37474f;" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10" GridPane.rowIndex="2" GridPane.columnIndex="0">
                                <FontAwesomeIconView glyphName="USER_MD" size="14" glyphStyle="-fx-fill: #1565c0;"/>
                                <Label text="Médecin traitant:" style="-fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-text-fill: #37474f;"/>
                            </HBox>
                            <Label fx:id="lblDossierMedecin" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 14px; -fx-text-fill: #37474f;" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10" GridPane.rowIndex="3" GridPane.columnIndex="0">
                                <FontAwesomeIconView glyphName="INFO_CIRCLE" size="14" glyphStyle="-fx-fill: #1565c0;"/>
                                <Label text="Statut:" style="-fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-text-fill: #37474f;"/>
                            </HBox>
                            <Label fx:id="lblDossierStatut" style="-fx-font-family: 'Segoe UI'; -fx-font-size: 14px; -fx-text-fill: #37474f;" GridPane.rowIndex="3" GridPane.columnIndex="1"/>
                        </GridPane>
                    </VBox>
                    
                    <!-- Medical History -->
                    <TitledPane text="Historique des maladies" expanded="true" maxHeight="Infinity"
                              style="-fx-font-family: 'Segoe UI'; -fx-font-weight: bold; -fx-text-fill: #1565c0; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                        <graphic>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <FontAwesomeIconView glyphName="HEARTBEAT" size="16" glyphStyle="-fx-fill: #f44336;"/>
                                <Label text="Historique Médical" style="-fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-text-fill: #f44336;"/>
                            </HBox>
                        </graphic>
                        <VBox style="-fx-background-color: white; -fx-background-radius: 0 0 10 10;" VBox.vgrow="ALWAYS">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <Label fx:id="lblHistoriqueMaladies" wrapText="true" 
                                  style="-fx-font-family: 'Segoe UI'; -fx-text-fill: #37474f; -fx-font-size: 14px; -fx-background-color: #f5f7fa; -fx-padding: 15; -fx-background-radius: 5; -fx-border-color: #e0e0e0; -fx-border-radius: 5; -fx-min-height: 100;"/>
                        </VBox>
                    </TitledPane>
                    
                    <!-- Past Operations -->
                    <TitledPane text="Opérations passées" expanded="true" maxHeight="Infinity"
                              style="-fx-font-family: 'Segoe UI'; -fx-font-weight: bold; -fx-text-fill: #1565c0; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                        <graphic>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <FontAwesomeIconView glyphName="SCISSORS" size="16" glyphStyle="-fx-fill: #2196f3;"/>
                                <Label text="Chirurgie" style="-fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-text-fill: #2196f3;"/>
                            </HBox>
                        </graphic>
                        <VBox style="-fx-background-color: white; -fx-background-radius: 0 0 10 10;" VBox.vgrow="ALWAYS">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <Label fx:id="lblOperationsPassees" wrapText="true" 
                                  style="-fx-font-family: 'Segoe UI'; -fx-text-fill: #37474f; -fx-font-size: 14px; -fx-background-color: #f5f7fa; -fx-padding: 15; -fx-background-radius: 5; -fx-border-color: #e0e0e0; -fx-border-radius: 5; -fx-min-height: 100;"/>
                        </VBox>
                    </TitledPane>
                    
                    <!-- Past Consultations -->
                    <TitledPane text="Consultations passées" expanded="true" maxHeight="Infinity"
                              style="-fx-font-family: 'Segoe UI'; -fx-font-weight: bold; -fx-text-fill: #1565c0; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                        <graphic>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <FontAwesomeIconView glyphName="STETHOSCOPE" size="16" glyphStyle="-fx-fill: #8e24aa;"/>
                                <Label text="Consultations" style="-fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-text-fill: #8e24aa;"/>
                            </HBox>
                        </graphic>
                        <VBox style="-fx-background-color: white; -fx-background-radius: 0 0 10 10;" VBox.vgrow="ALWAYS">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <Label fx:id="lblConsultationsPassees" wrapText="true" 
                                  style="-fx-font-family: 'Segoe UI'; -fx-text-fill: #37474f; -fx-font-size: 14px; -fx-background-color: #f5f7fa; -fx-padding: 15; -fx-background-radius: 5; -fx-border-color: #e0e0e0; -fx-border-radius: 5; -fx-min-height: 100;"/>
                        </VBox>
                    </TitledPane>
                    
                    <!-- Notes -->
                    <TitledPane text="Notes" expanded="true" maxHeight="Infinity"
                              style="-fx-font-family: 'Segoe UI'; -fx-font-weight: bold; -fx-text-fill: #1565c0; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                        <graphic>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <FontAwesomeIconView glyphName="STICKY_NOTE" size="16" glyphStyle="-fx-fill: #ff9800;"/>
                                <Label text="Informations complémentaires" style="-fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-text-fill: #ff9800;"/>
                            </HBox>
                        </graphic>
                        <VBox style="-fx-background-color: white; -fx-background-radius: 0 0 10 10;" VBox.vgrow="ALWAYS">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <Label fx:id="lblNotes" wrapText="true" 
                                  style="-fx-font-family: 'Segoe UI'; -fx-text-fill: #37474f; -fx-font-size: 14px; -fx-background-color: #f5f7fa; -fx-padding: 15; -fx-background-radius: 5; -fx-border-color: #e0e0e0; -fx-border-radius: 5; -fx-min-height: 100;"/>
                        </VBox>
                    </TitledPane>
                </VBox>
            </ScrollPane>
            
            <!-- Séjours Content -->
            <VBox fx:id="sejoursContent" spacing="20" visible="false" managed="false">
                <padding>
                    <Insets top="30" right="30" bottom="30" left="30"/>
                </padding>
                
                <VBox spacing="15" style="-fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>
                    
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <FontAwesomeIconView glyphName="BED" size="24" glyphStyle="-fx-fill: #1565c0;"/>
                        <Label text="Mes Séjours Hospitaliers" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1565c0; -fx-font-family: 'Segoe UI';"/>
                    </HBox>
                    
                    <TableView fx:id="allSejoursTable" prefHeight="400" style="-fx-border-color: #E0E0E0; -fx-border-radius: 5;">
                        <columns>
                            <TableColumn fx:id="colAllDateEntree" text="Date d'entrée" prefWidth="140"/>
                            <TableColumn fx:id="colAllDateSortie" text="Date de sortie" prefWidth="140"/>
                            <TableColumn fx:id="colAllTypeSejour" text="Type" prefWidth="140"/>
                            <TableColumn fx:id="colAllFraisSejour" text="Frais" prefWidth="120"/>
                            <TableColumn fx:id="colAllMoyenPaiement" text="Moyen de paiement" prefWidth="140"/>
                            <TableColumn fx:id="colAllStatutPaiement" text="Statut" prefWidth="120"/>
                        </columns>
                        <placeholder>
                            <HBox alignment="CENTER" spacing="10">
                                <FontAwesomeIconView glyphName="INFO_CIRCLE" size="20" glyphStyle="-fx-fill: #90a4ae;"/>
                                <Label text="Aucun séjour enregistré" style="-fx-font-family: 'Segoe UI'; -fx-text-fill: #90a4ae;"/>
                            </HBox>
                        </placeholder>
                    </TableView>
                    
                    <HBox alignment="CENTER_RIGHT">
                        <Button fx:id="btnVoirDetailSejour" text="Voir détails" onAction="#handleVoirDetailSejour" 
                              style="-fx-background-color: #1565c0; -fx-text-fill: white; -fx-font-weight: bold; -fx-font-family: 'Segoe UI'; -fx-background-radius: 5; -fx-padding: 8 15;">
                            <graphic>
                                <FontAwesomeIconView glyphName="EYE" size="14" glyphStyle="-fx-fill: white;"/>
                            </graphic>
                        </Button>
                    </HBox>
                </VBox>
            </VBox>
        </StackPane>
    </center>
    
    <bottom>
        <HBox alignment="CENTER" style="-fx-background-color: #1565c0; -fx-padding: 10;">
            <Label text="Système de Gestion Médicale | Espace Patient" style="-fx-text-fill: white; -fx-font-family: 'Segoe UI';"/>
        </HBox>
    </bottom>
</BorderPane> 